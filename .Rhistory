}
for (x in game_ids$game_id) {
if (file.exists(fplayers)==TRUE & grepl("END GAME", xpbp$desc[nrow(xpbp)]) == TRUE)
{
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
xpbp <- game_play_by_play(x)
addTargets(x)
} else {
## scrape player stats
xplayers <- player_game(x)
print(paste("X =", x))
xpbp <- game_play_by_play(x)
addTargets(x)
}
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
## create targets dataframe
xpbp <- read.csv(paste("data/games/", userYear, "/", x, ".csv", sep = ""))
targets <- filter(xpbp, play_type == "Pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- read.csv(paste("data/players/", userYear , "/", x , "players.csv", sep = ""))
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
playerSeason$targets[is.na(playerSeason$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
for (x in game_ids$game_id) {
if (file.exists(fplayers)==TRUE & grepl("END GAME", xpbp$desc[nrow(xpbp)]) == TRUE)
{
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
xpbp <- game_play_by_play(x)
addTargets(x)
} else {
## scrape player stats
xplayers <- player_game(x)
print(paste("X =", x))
xpbp <- game_play_by_play(x)
addTargets(x)
}
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
## create targets dataframe
xpbp <- read.csv(paste("data/games/", userYear, "/", x, ".csv", sep = ""))
targets <- filter(xpbp, play_type == "Pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- read.csv(paste("data/players/", userYear , "/", x , "players.csv", sep = ""))
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
playerSeason$targets[is.na(playerSeason$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
warnings()
for (x in game_ids$game_id) {
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
xpbp <- game_play_by_play(x)
addTargets(x)
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
## create targets dataframe
xpbp <- read.csv(paste("data/games/", userYear, "/", x, ".csv", sep = ""))
targets <- filter(xpbp, play_type == "Pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- read.csv(paste("data/players/", userYear , "/", x , "players.csv", sep = ""))
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
playerSeason$targets[is.na(playerSeason$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
for (x in game_ids$game_id) {
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
## create targets dataframe
xpbp <- read.csv(paste("data/games/", userYear, "/", x, ".csv", sep = ""))
targets <- filter(xpbp, play_type == "Pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- read.csv(paste("data/players/", userYear , "/", x , "players.csv", sep = ""))
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
playerSeason$targets[is.na(playerSeason$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
for (x in game_ids$game_id) {
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
xplayers <- read.csv(paste("data/players/", userYear , "/", x , "players.csv", sep = ""))
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
## create targets dataframe
xpbp <- read.csv(paste("data/games/", userYear, "/", x, ".csv", sep = ""))
targets <- filter(xpbp, play_type == "Pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
playerSeason$targets[is.na(playerSeason$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
View(xplayers)
for (x in game_ids$game_id) {
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
xplayers <- read.csv(fplayers)
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
## create targets dataframe
xpbp <- read.csv(paste("data/games/", userYear, "/", x, ".csv", sep = ""))
targets <- filter(xpbp, play_type == "Pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
playerSeason$targets[is.na(playerSeason$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
game_ids$game_id
View(xplayers)
View(xplayers)
game_ids$game_id
sort(game_ids$game_id, decreasing = FALSE)
for (x in game_ids$game_id) {
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
xplayers <- read.csv(fplayers)
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
## create targets dataframe
xpbp <- read.csv(paste("data/games/", userYear, "/", x, ".csv", sep = ""))
targets <- filter(xpbp, play_type == "Pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
playerSeason$targets[is.na(playerSeason$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
rm(x)
rm(z)
for (x in game_ids$game_id) {
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
xplayers <- read.csv(fplayers)
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
## create targets dataframe
xpbp <- read.csv(paste("data/games/", userYear, "/", x, ".csv", sep = ""))
targets <- filter(xpbp, play_type == "Pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
playerSeason$targets[is.na(playerSeason$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
x
lapply(game_ids$game_id, addTargets)
lapply(game_ids$game_id, addTargets)
class(game_ids$game_id)
for (x in game_ids$game_id) {
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
## create targets dataframe
xpbp <- read.csv(paste("data/games/", userYear, "/", x, ".csv", sep = ""))
targets <- filter(xpbp, play_type == "Pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
playerSeason$targets[is.na(playerSeason$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
View(xpbp)
for (x in game_ids$game_id) {
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
## create targets dataframe
xpbp <- read.csv(paste("data/games/", userYear, "/", x, ".csv", sep = ""))
targets <- filter(xpbp, play_type == "Pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
xplayers$targets[is.na(xplayers$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
xplayers
targets <- filter(xpbp, play_type == "Pass" & receiver_player_id != "NA")
View(targets)
xpbp$play_type
targets <- filter(xpbp, play_type == "pass" & receiver_player_id != "NA")
targets
View(targets)
addTargets <- function(x) {
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
## create targets dataframe
xpbp <- read.csv(paste("data/games/", userYear, "/", x, ".csv", sep = ""))
targets <- filter(xpbp, play_type == "pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- read.csv(paste("data/players/", userYear , "/", x , "players.csv", sep = ""))
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
playerSeason$targets[is.na(playerSeason$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
for (x in game_ids$game_id) {
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
## create targets dataframe
xpbp <- read.csv(paste("data/games/", userYear, "/", x, ".csv", sep = ""))
targets <- filter(xpbp, play_type == "pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
xplayers$targets[is.na(xplayers$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
for (x in game_ids$game_id) {
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
## create targets dataframe
fpbp = paste("data/games/", userYear, "/", x, ".csv", sep = "")
xpbp <- read.csv(fpbp)
targets <- filter(xpbp, play_type == "pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
xplayers$targets[is.na(xplayers$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
warning()
source('~/.active-rstudio-document')
install.packages(c("broom", "dplyr", "gganimate", "knitr", "magick", "rlang", "teamcolors", "tidyr", "tidyselect"))
install.packages(c("callr", "DT", "gh", "jsonlite", "mime", "nlme", "prettyunits", "processx", "rlang", "rstudioapi", "vctrs", "yaml"), lib="/Library/Frameworks/R.framework/Versions/3.6/Resources/library")
library(nflscrapR)
library(tidyverse)
library(readr)
library(pander)
library(dplyr)
library(na.tools)
library(ggimage)
library(teamcolors) # NFL team colors and logos
library(plyr)
library(readr)
library(glue)
##library(animate)
library(animation)
library(tictoc)
library(gt) # beautiful tables
library(DT) # beautiful interactive tables
library(ggthemes) # custom pre-built themes
library(bbplot) # more themes
library(ggtext) # custom text color
library(ggforce) # better annotations
library(ggridges) # many distributions at once
library(ggrepel) # better labels
library(ggbeeswarm) # beeswarm plots
library(extrafont) # for extra fonts
##reset
setwd("~/")
gid <- paste(getwd())
gid
device <- ""
if (gid == "/Volumes/HDD/Users/colinwelsh") {
##Maverick - MBP
setwd("~/Documents/dev/football")
device <- "Maverick (MBP)"
} else if (gid == "/Users/ColinWelsh") {
##Goose - iMac
setwd("~/Documents/dev/football")
device <- "Goose (iMac)"
##add Goose
}
print(paste(device, "is ready for some football", sep = " "))
rm(gid, device)
# other dependent variables
today <- Sys.Date()
#   test date
##  date <- 202001
date <- format(today, format="%Y%m%d")
userYear <- 2019 ##necessary for saved
userWeek <- 17 ##not necessary at the moment
seasonState <- "post"
fgame_ids <- paste("data/games/", seasonState, "_season/", seasonState, "_games_", userYear, ".csv", sep ="")
fteamabbr <- paste("data/season_total/team_abbr.csv", sep = "")
teams <- read.csv(fteamabbr)
game_ids <- read.csv(fgame_ids)
game_ids <- scrape_game_ids(userYear, type = seasonState)
write.csv(game_ids, fgame_ids)
source("functions/scrapePBP.R")
source("functions/addTargets.R")
View(game_ids)
for (x in game_ids$game_id) {
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
## create targets dataframe
fpbp = paste("data/games/", userYear, "/", x, ".csv", sep = "")
xpbp <- read.csv(fpbp)
targets <- filter(xpbp, play_type == "pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
xplayers$targets[is.na(xplayers$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
paste("data/games/", userYear, "/", x, ".csv", sep = "")
fpbp = paste("data/games/", userYear, "/", x, ".csv", sep = "")
xpbp <- read.csv(fpbp)
targets <- filter(xpbp, play_type == "pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$Receiver_ID)
xreceivers <- unique(targets$Receiver_ID)
unique(targets$Receiver_ID)
targets$receiver_player_id
xreceivers <- unique(targets$receiver_player_id)
for (x in game_ids$game_id) {
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
## create targets dataframe
fpbp = paste("data/games/", userYear, "/", x, ".csv", sep = "")
xpbp <- read.csv(fpbp)
targets <- filter(xpbp, play_type == "pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$receiver_player_id)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
xplayers$targets[is.na(xplayers$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
View(xplayers)
sum(targets$Receiver_ID == z
)
xplayers[xplayers$playerID == z, "targets"]
z
for (x in game_ids$game_id) {
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
fpbp = paste("data/games/", userYear, "/", x, ".csv", sep = "")
xpbp <- read.csv(fpbp)
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
## create targets dataframe
targets <- filter(xpbp, play_type == "pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$receiver_player_id)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## bring targets column next to the receptions
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
xplayers$targets[is.na(xplayers$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
xreceivers
xreceivers[1]
xreceivers[2]
xplayers$playerID
lapply(xreceivers, xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z))
?lapply(list, function)
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
}
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$Receiver_ID == z)
z
}
z
targets$receiver_player_id
unique(targets$receiver_player_id)
xpbp
View(xpbp)
x
View(xplayers)
xreceivers
View(targets)
xplayers$targets
xplayers[xplayers$playerID == z, "targets"]
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$receiver_player_id == z)
}
for (x in game_ids$game_id) {
fplayers <- paste("data/players/", userYear, "/", x, "players.csv", sep = "")
fpbp = paste("data/games/", userYear, "/", x, ".csv", sep = "")
xpbp <- read.csv(fpbp)
xplayers <- player_game(x)
write.csv(xplayers, fplayers, row.names = FALSE)
print(paste("X =", x))
## create targets dataframe
targets <- filter(xpbp, play_type == "pass" & receiver_player_id != "NA")
xreceivers <- unique(targets$receiver_player_id)
## add targets to stats
for (z in xreceivers) {
xplayers[xplayers$playerID == z, "targets"] <- sum(targets$receiver_player_id == z)
}
## bring targets column next to the receptions
xplayers <- xplayers[,c(1:20,ncol(xplayers),22:ncol(xplayers)-1)]
xplayers$targets[is.na(xplayers$targets)] <- 0
write.csv(xplayers, fplayers, row.names = FALSE)
}
pbpSeason <- list.files(paste("data/games/", userYear, "/", sep = ""),
pattern = "*.csv", full.names = TRUE) %>%
lapply(read_csv) %>%
bind_rows
pbpSeason
write.csv(pbpSeason, file = paste("data/season_total/", userYear,"pbp.csv", sep = ""), row.names = FALSE)
playerSeason <- list.files(paste("data/players/", userYear, "/", sep = ""),
pattern = "*.csv", full.names = TRUE) %>%
lapply(read_csv) %>%
bind_rows
playerSeason
write.csv(playerSeason, file = paste("data/season_total/", userYear, "players.csv", sep = ""), row.names = FALSE)
View(playerSeason)
trgtsSeason <- playerSeason %>% filter(targets > 1)
View(trgtsSeason)
trgtsSeason$playerID
unique(trgtsSeason$playerID
)
View(trgtsSeason)
View(trgtsSeason)
colSums(playerSeason)
colSums(x = playerSeason)
colnames(playerSeason)
list.files(paste("data/players/", userYear, "/", sep = ""),
pattern = "*.csv", full.names = TRUE)
fplayersList <- list.files(paste("data/players/", userYear, "/", sep = ""),
pattern = "*.csv", full.names = TRUE)
View(playerSeason)
?summarise_each
?funs
playerSeason %>% group_by(playerID) %>% summarise_each(funs(sum))
?tapply(vector, index, function)
?tapply
playerSeason %>%
group_by(playerID) %>%
summarise_all(funs(sum))
?summarise_at
?vars
playerSeason %>%
group_by(playerID) %>%
summarise_at(vars(funs(sum)))
